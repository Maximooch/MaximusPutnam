<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Maximus Putnam</title>
<meta name="description" content="Maximus Putnam ‚Äî founder of Penguin. Building Link & Penguin: an AI workspace and a software-engineering agent." />
<style>
  :root{
    --bg:#C0C0C0; --chrome:#E0E0E0; --shadow:#9a9a9a; --dark:#000; --light:#fff; --title:#d6d6d6; --text:#111;
  }
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font:14px/1.35 system-ui,-apple-system,"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
    background:
      repeating-linear-gradient(0deg,#d7d7d7 0 1px,#d2d2d2 1px 2px),
      repeating-linear-gradient(90deg,#dcdcdc 0 1px,#d6d6d6 1px 2px);
    image-rendering: pixelated; overflow:hidden;
  }

  /* ===== Menubar ===== */
  .menubar{
    position:fixed; inset:0 0 auto 0; height:26px;
    display:flex; align-items:center; justify-content:space-between;
    background:linear-gradient(#f2f2f2,#e5e5e5);
    border-bottom:2px solid var(--shadow);
    padding:0 8px; z-index:9999; user-select:none;
  }
  .menu-left,.menu-right{display:flex; gap:14px; align-items:center;}
  .apple{font-weight:700}
  .menu-item{cursor:default}
  .menu-item:hover{background:#000;color:#fff;padding:2px 4px;border-radius:2px}

  /* ===== Desktop & Icons ===== */
  .desktop{position:absolute; inset:26px 0 0 0; padding:20px; overflow:hidden;}
  .icons{display:grid; grid-template-columns:repeat(auto-fill,96px); gap:24px; width:min(900px,100%)}
  .icon{width:96px; text-align:center; user-select:none; cursor:default;}
  .icon .glyph{
    width:60px;height:46px;margin:0 auto 6px;background:var(--chrome);
    border:2px solid var(--dark);box-shadow:2px 2px 0 0 var(--shadow),inset -2px -2px 0 #bbb,inset 2px 2px 0 #f6f6f6;
    display:grid;place-items:center;font-size:24px;filter:grayscale(1) contrast(1.2);
  }
  .icon.selected .label{background:#000;color:#fff}
  .icon .label{display:inline-block;padding:2px 6px;border-radius:2px;font-size:12px}

  /* ===== Windows ===== */
  .window{
    position:absolute; min-width:320px; max-width:min(800px,calc(100% - 40px));
    background:var(--chrome); border:2px solid var(--dark); box-shadow:4px 4px 0 0 var(--shadow);
    top:120px; left:120px; z-index:5; display:none;
  }
  .titlebar{
    height:24px;background:var(--title);border-bottom:2px solid var(--shadow);
    display:flex;align-items:center;gap:8px;padding:0 6px;user-select:none;cursor:grab;
  }
  .controls{display:flex;gap:4px}
  .btn{width:14px;height:14px;border:2px solid var(--dark);background:var(--light);box-shadow:inset -2px -2px 0 #c9c9c9,inset 2px 2px 0 #fff}
  .btn.min::after{content:"";display:block;width:8px;height:2px;margin:4px auto;background:#000}
  .btn.zoom::after{content:"";display:block;width:6px;height:6px;border:2px solid #000;margin:1px auto}
  .btn.close::after{content:"";display:block;width:8px;height:8px;margin:1px auto;background:conic-gradient(#000 0 25%,#0000 0 50%,#000 0 75%,#0000 0);mask:radial-gradient(circle at 50% 50%,#0000 4px,#000 4px)}
  .title{font-weight:700}
  .content{padding:12px;background:#f6f6f6}
  .content h2{margin:0 0 8px 0;font-size:18px}
  .pill{display:inline-block;font-size:12px;padding:2px 8px;border:2px solid #000;background:#fff;margin:2px 4px 0 0}
  a{color:#0022aa;text-decoration:underline}
  .footnote{font-size:12px;opacity:.8}

  /* ===== Finder ===== */
  .finder{display:grid;grid-template-columns:180px 1fr;min-height:300px;background:#fff;border:2px solid #000}
  .sidebar{border-right:2px solid #000;background:#efefef}
  .sidebar h3{font-size:12px;margin:8px 8px 4px}
  .side-list{list-style:none;margin:0;padding:0}
  .side-list li{padding:6px 10px;cursor:default}
  .side-list li.active,.side-list li:hover{background:#000;color:#fff}
  .browser{padding:10px}
  .crumbs{font-size:12px;margin-bottom:6px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,108px);gap:12px}
  .file{
    width:108px;text-align:center;cursor:default;user-select:none
  }
  .file .ico{
    width:64px;height:54px;margin:0 auto 6px;background:#e9e9e9;border:2px solid #000;
    box-shadow:2px 2px 0 0 var(--shadow),inset -2px -2px 0 #bbb,inset 2px 2px 0 #f6f6f6;
    display:grid;place-items:center;font-size:22px
  }
  .file .name{font-size:12px;padding:2px 4px;border-radius:2px}
  .file.selected .name{background:#000;color:#fff}

  /* ===== Blog viewer ===== */
  .postlist li{margin:6px 0}
  .viewer{max-height:60vh; overflow:auto; padding:8px; background:#fff; border:2px solid #000}
  .viewer h1,.viewer h2,.viewer h3{margin:10px 0 6px}
  .viewer pre{overflow:auto;background:#f0f0f0;border:2px solid #000;padding:8px}
  .viewer code{background:#efefef;padding:1px 3px;border:1px solid #000}

  /* ===== Command palette ===== */
  .palette{
    position:fixed; inset:80px auto auto 50%; transform:translateX(-50%);
    width:min(640px,92%); background:#fefefe; border:2px solid #000; box-shadow:6px 6px 0 var(--shadow);
    display:none; z-index:10000;
  }
  .palette .head{padding:8px;border-bottom:2px solid #000;background:#eaeaea}
  .palette input{width:100%;font-size:16px;padding:6px;border:2px solid #000;outline:none}
  .palette ul{list-style:none;margin:0;padding:6px;max-height:50vh;overflow:auto}
  .palette li{padding:6px;cursor:default}
  .palette li.active,.palette li:hover{background:#000;color:#fff}

  @media (max-width:720px){
    .icons{grid-template-columns:repeat(auto-fill,84px);gap:18px}
    .icon{width:84px}
    .window{min-width:260px}
  }
</style>
</head>
<body>
  <!-- ===== Menubar ===== -->
  <div class="menubar" role="navigation" aria-label="Menu bar">
    <div class="menu-left">
      <div class="apple">Ô£ø</div>
      <div class="menu-item" data-open="#about">About This Mac‚Ä¶</div>
      <div class="menu-item" data-open="#finder">File</div>
      <div class="menu-item" data-open="#blog">View</div>
      <div class="menu-item" data-open="#contact">Special</div>
    </div>
    <div class="menu-right">
      <div class="menu-item" id="clock">--:--</div>
    </div>
  </div>

  <!-- ===== Desktop ===== -->
  <div class="desktop" id="desktop">
    <div class="icons">
      <div class="icon" tabindex="0" data-open="#about">
        <div class="glyph">üë§</div><div class="label">About Me</div>
      </div>
      <div class="icon" tabindex="0" data-open="#now">
        <div class="glyph">üóìÔ∏è</div><div class="label">Now</div>
      </div>
      <div class="icon" tabindex="0" data-open="#projects">
        <div class="glyph">üóÇÔ∏è</div><div class="label">Projects</div>
      </div>
      <div class="icon" tabindex="0" data-open="#finder">
        <div class="glyph">üñø</div><div class="label">Finder</div>
      </div>
      <div class="icon" tabindex="0" data-open="#blog">
        <div class="glyph">üìù</div><div class="label">Blog</div>
      </div>
      <div class="icon" tabindex="0" data-open="#contact">
        <div class="glyph">‚úâÔ∏è</div><div class="label">Contact</div>
      </div>
    </div>
  </div>

  <!-- ===== Windows ===== -->
  <section class="window" id="about" style="top:110px;left:80px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">About Me</div>
    </div>
    <div class="content">
      <h2>Hey, I‚Äôm Maximus Putnam</h2>
      <p>Founder of <strong>Penguin</strong> ‚Äî building <strong>Link</strong> (AI workspace for chat/projects/automation) and <strong>Penguin</strong> (software-engineering agent).</p>
      <ul>
        <li>Self-taught SWE; now deep in Python + agent cognitive architectures.</li>
        <li>Focus: agentic reasoning, orchestration, memory, tool use, and cost-efficient inference (vLLM / SGLang).</li>
        <li>Interests: semiconductors & US manufacturing, energy (nuclear/geothermal), robotics/automation, civic infra, theology & church history, occasional game design.</li>
      </ul>
      <p class="footnote">This site is intentionally retro: 0 frameworks, just HTML/CSS/JS.</p>
    </div>
  </section>

  <section class="window" id="now" style="top:160px;left:440px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">Now</div>
    </div>
    <div class="content">
      <h2>What I‚Äôm doing now</h2>
      <ul>
        <li>Shipping core <strong>Link</strong> features (OAuth, multi-panel workspace, real-time chat & project graph).</li>
        <li>Hardening <strong>Penguin</strong> (execution env, memory, multi-agent handoffs, checkpoints/branching).</li>
        <li>Spooling GPU capacity across clouds; exploring on-prem for cost/perf.</li>
        <li>Talking to early users and angels; recruiting founding engineers soon.</li>
      </ul>
      <div>
        <span class="pill">AI Agents</span><span class="pill">Reasoning</span><span class="pill">Infra</span>
        <span class="pill">Cost-efficiency</span><span class="pill">Execution</span>
      </div>
    </div>
  </section>

  <section class="window" id="projects" style="top:260px;left:120px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">Projects</div>
    </div>
    <div class="content">
      <h2>Selected Work</h2>
      <p><strong>Link</strong> ‚Äî AI workspace for teams: chat, projects, automations, agent orchestration, and context visualization.</p>
      <p><strong>Penguin</strong> ‚Äî software-engineering agent with execution env, long-term memory, and multi-agent coordination.</p>
      <p><strong>Krill (Terminal)</strong> ‚Äî cozy, modern terminal/task-graph interface (integrates with Link).</p>
      <p><strong>Penguin Saloon</strong> ‚Äî tabletop strategy card game (digital version planned).</p>
    </div>
  </section>

  <!-- ===== Finder ===== -->
  <section class="window" id="finder" style="top:120px;left:200px;max-width:900px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">Finder ‚Äî Macintosh HD</div>
    </div>
    <div class="content">
      <div class="finder">
        <aside class="sidebar">
          <h3>Favorites</h3>
          <ul class="side-list" id="favList"></ul>
        </aside>
        <main class="browser">
          <div class="crumbs" id="crumbs">Macintosh HD</div>
          <div class="grid" id="grid"></div>
        </main>
      </div>
      <p class="footnote">Double-click folders to navigate. Double-click files to open (Markdown opens in viewer; links open in a new tab).</p>
    </div>
  </section>

  <!-- ===== Blog ===== -->
  <section class="window" id="blog" style="top:180px;left:520px;max-width:900px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">Blog</div>
    </div>
    <div class="content">
      <h2>Posts</h2>
      <ul id="postList" class="postlist"></ul>
      <div id="postView" class="viewer" style="display:none; margin-top:10px;"></div>
    </div>
  </section>

  <!-- ===== Generic Viewer (images/md fallback) ===== -->
  <section class="window" id="viewer" style="top:220px;left:260px;max-width:900px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">Viewer</div>
    </div>
    <div class="content">
      <div id="viewerBody" class="viewer"></div>
    </div>
  </section>

  <!-- ===== Contact ===== -->
  <section class="window" id="contact" style="top:420px;left:220px;">
    <div class="titlebar">
      <div class="controls"><div class="btn close" data-close></div><div class="btn min" data-min></div><div class="btn zoom" data-zoom></div></div>
      <div class="title">Contact</div>
    </div>
    <div class="content">
      <h2>Get in touch</h2>
      <p>Email: <a href="mailto:hi@maximusputnam.com">hi@maximusputnam.com</a></p>
      <p>Based in Dallas, TX (often online).</p>
      <p class="footnote">Hiring: early engineers (full-stack, infra, agents). If you‚Äôre unusually good and bias to action, reach out.</p>
    </div>
  </section>

  <!-- ===== Command Palette ===== -->
  <div class="palette" id="palette" role="dialog" aria-modal="true">
    <div class="head"><input id="pinput" placeholder="Type a command‚Ä¶ (e.g., 'open blog', 'open finder', 'post penguin')" autocomplete="off" /></div>
    <ul id="presults"></ul>
  </div>

<script>
/*** Utilities ***/
const $$ = (sel, root=document)=> Array.from(root.querySelectorAll(sel));
const byId = id => document.getElementById(id);
const windows = () => $$('.window');
const openWindow = sel => { const w=document.querySelector(sel); if(!w) return; w.style.display='block'; bringToFront(w); };
function bringToFront(el){ if(!bringToFront.z) bringToFront.z = 10; el.style.zIndex = ++bringToFront.z; }

/*** Menubar clock ***/
function fmt(d){ const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]; let h=d.getHours(), m=String(d.getMinutes()).padStart(2,"0"); const ampm=h>=12?"PM":"AM"; h=h%12||12; return `${days[d.getDay()]} ${String(h).padStart(2,"0")}:${m} ${ampm}`; }
function tick(){ byId('clock').textContent=fmt(new Date()); } tick(); setInterval(tick, 10000);

/*** Desktop icons & menu items ***/
$$('.icon').forEach(icon=>{
  icon.addEventListener('click', ()=>{$$('.icon').forEach(i=>i.classList.remove('selected')); icon.classList.add('selected');});
  icon.addEventListener('dblclick', ()=> openWindow(icon.getAttribute('data-open')));
});
$$('[data-open]').forEach(mi=> mi.addEventListener('click', ()=> openWindow(mi.getAttribute('data-open'))));

/*** Window chrome (drag/zoom/close) ***/
windows().forEach(w=>{
  bringToFront(w);
  const tb = w.querySelector('.titlebar'); let sx=0, sy=0, sl=0, st=0, dragging=false;
  tb.addEventListener('mousedown', e=>{dragging=true;tb.style.cursor='grabbing';bringToFront(w);sx=e.clientX;sy=e.clientY;const r=w.getBoundingClientRect();sl=r.left;st=r.top;e.preventDefault();});
  window.addEventListener('mousemove', e=>{ if(!dragging) return; const dx=e.clientX-sx, dy=e.clientY-sy; let L=sl+dx, T=Math.max(26, st+dy); const maxL=innerWidth-w.offsetWidth-8, maxT=innerHeight-w.offsetHeight-8; w.style.left=Math.min(Math.max(8,L),Math.max(8,maxL))+'px'; w.style.top=Math.min(Math.max(26,T),Math.max(26,maxT))+'px'; });
  window.addEventListener('mouseup', ()=>{dragging=false;tb.style.cursor='grab';});
  w.querySelectorAll('[data-close]').forEach(b=>b.onclick=()=>w.style.display='none');
  w.querySelectorAll('[data-min]').forEach(b=>b.onclick=()=>w.style.display='none');
  w.querySelectorAll('[data-zoom]').forEach(b=>b.onclick=()=>{
    bringToFront(w); const isMax = w.dataset.max==="1";
    if(isMax){ w.style.left=w.dataset.left; w.style.top=w.dataset.top; w.style.width=w.dataset.width; w.style.height=w.dataset.height; w.dataset.max="0"; }
    else{ const r=w.getBoundingClientRect(); w.dataset.left=w.style.left||r.left+"px"; w.dataset.top=w.style.top||r.top+"px"; w.dataset.width=w.style.width||r.width+"px"; w.dataset.height=w.style.height||r.height+"px"; w.style.left="8px"; w.style.top="28px"; w.style.width=(innerWidth-16)+"px"; w.style.height=(innerHeight-36)+"px"; w.dataset.max="1"; }
  });
  w.addEventListener('mousedown', ()=>bringToFront(w));
});

/*** Markdown (tiny, safe-ish) ***/
function escapeHTML(s){ return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
function mdToHtml(md){
  md = md.replace(/\r\n/g,"\n");
  // code blocks first
  let blocks=[], i=0;
  md = md.replace(/```([\s\S]*?)```/g,(m,code)=>{blocks.push(`<pre><code>${escapeHTML(code)}</code></pre>`); return `\u0000${i++}\u0000`;});
  md = escapeHTML(md);
  // headings
  md = md.replace(/^###### (.*)$/gm,'<h6>$1</h6>')
         .replace(/^##### (.*)$/gm,'<h5>$1</h5>')
         .replace(/^#### (.*)$/gm,'<h4>$1</h4>')
         .replace(/^### (.*)$/gm,'<h3>$1</h3>')
         .replace(/^## (.*)$/gm,'<h2>$1</h2>')
         .replace(/^# (.*)$/gm,'<h1>$1</h1>');
  // lists
  md = md.replace(/^(?:\s*[-+*] .*(\n|$))+?/gm, m=>{
    const items = m.trim().split(/\n/).map(l=>l.replace(/^\s*[-+*]\s+/,'').trim()).map(t=>`<li>${t}</li>`).join('');
    return `<ul>${items}</ul>`;
  });
  // numbered lists
  md = md.replace(/^(?:\s*\d+[.)] .*(\n|$))+?/gm, m=>{
    const items = m.trim().split(/\n/).map(l=>l.replace(/^\s*\d+[.)]\s+/,'').trim()).map(t=>`<li>${t}</li>`).join('');
    return `<ol>${items}</ol>`;
  });
  // inline
  md = md.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
         .replace(/(\s|^)\*(?!\s)(.+?)(?<!\s)\*(\s|$)/g,'$1<em>$2</em>$3')
         .replace(/`([^`]+?)`/g,'<code>$1</code>')
         .replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>');
  // paragraphs
  md = md.split(/\n{2,}/).map(b=>{
    if(/^<\/?(h\d|ul|ol|pre)/.test(b.trim())) return b;
    return `<p>${b.replace(/\n/g,'<br>')}</p>`;
  }).join('\n');
  // restore code blocks
  md = md.replace(/\u0000(\d+)\u0000/g,(_,k)=>blocks[+k]||'');
  return md;
}

/*** Posts (inline sample; will auto-load /posts/index.json if present) ***/
const inlinePosts = [
  {
    slug:'hello-linkai', title:'Hello, LinkAI', date:'2025-08-01', tags:['agents','infra'],
    body:`# Hello, LinkAI
We're building **Link** (workspace) and **Penguin** (software-engineering agent).
- Orchestration, memory, tool-use
- Cost-aware inference (vLLM/SGLang)
- Focused on *shipping*`
  },
  {
    slug:'penguin-design-notes', title:'Penguin: design notes', date:'2025-08-05', tags:['penguin','design'],
    body:`# Penguin Design Notes
1. Execution sandbox + file graph
2. Checkpoint/branching for task state
3. Multi-agent handoffs
4. Long-term memory + evals`
  },
  {
    slug:'energy-realism', title:'Energy realism for startups', date:'2025-08-07', tags:['energy','infra'],
    body:`## Energy Realism
Geothermal + nuclear-forward planning. Targets: low *marginal* kWh, reliable capacity, and predictable siting.`
  }
];

async function loadPostIndex(){
  try{
    const res = await fetch('/posts/index.json',{cache:'no-store'});
    if(res.ok){ const arr = await res.json(); return Array.isArray(arr)&&arr.length?arr:inlinePosts; }
  }catch(e){}
  return inlinePosts;
}
async function loadPostBody(p){
  if(p.body) return p.body;
  try{
    const res = await fetch(`/posts/${p.slug}.md`,{cache:'no-store'});
    if(res.ok) return await res.text();
  }catch(e){}
  return `# Missing\nCould not load **${p.title}**. Create /posts/${p.slug}.md to override.`;
}

/*** Blog rendering ***/
let POSTS = [];
async function renderBlog(){
  POSTS = await loadPostIndex();
  const list = byId('postList'); list.innerHTML='';
  POSTS.sort((a,b)=> (b.date||'').localeCompare(a.date||''));
  POSTS.forEach(p=>{
    const li = document.createElement('li');
    li.innerHTML = `<a href="#" data-slug="${p.slug}">${p.title}</a> <span class="footnote">(${p.date||'n.d.'})</span>`;
    li.querySelector('a').onclick = async (e)=>{e.preventDefault(); openWindow('#blog'); const md = await loadPostBody(p); const html = mdToHtml(md); const pv=byId('postView'); pv.style.display='block'; pv.innerHTML=html; };
    list.appendChild(li);
  });
}

/*** Finder (simple in-memory FS; Writing is backed by posts) ***/
let FS_ROOT = null, CWD = null;
function buildFS(){
  FS_ROOT = {
    name:'Macintosh HD', type:'folder', children:[
      {name:'Desktop', type:'folder', children:[
        {name:'ReadMe.txt', type:'md', body:'# Welcome\nThis is a retro desktop.'},
        {name:'LinkAI.url', type:'link', href:'https://link.ai'}
      ]},
      {name:'Documents', type:'folder', children:[
        {name:'Link-Architecture.md', type:'md', body:'## Link Architecture\nGraph-based projects, agents, and real-time context.'},
        {name:'Resume-Maximus.pdf', type:'file', href:'#'} // placeholder
      ]},
      {name:'Writing', type:'folder', dynamic:'posts'}, // auto from POSTS
      {name:'Pictures', type:'folder', children:[
        {name:'krill.png', type:'img', href:'https://upload.wikimedia.org/wikipedia/commons/3/3a/Antarctic_krill.jpg'}
      ]},
      {name:'Links', type:'folder', children:[
        {name:'Penguin Docs.url', type:'link', href:'https://penguin-rho.vercel.app/docs/intro'}
      ]}
    ]
  };
  return FS_ROOT;
}
function nodeByPath(path){
  let n = FS_ROOT; for(const part of path){ if(!n.children) return null; n = n.children.find(c=>c.name===part); if(!n) return null; }
  return n;
}
function setCWD(path){ CWD = path; renderFinder(); }
function renderFinderSidebar(){
  const fav = byId('favList'); fav.innerHTML='';
  const favorites = ['Desktop','Documents','Writing','Pictures','Links'];
  favorites.forEach(name=>{
    const li = document.createElement('li'); li.textContent=name;
    li.onclick=()=> setCWD([name]);
    if(CWD && CWD[0]===name) li.classList.add('active');
    fav.appendChild(li);
  });
}
function renderFinder(){
  // hydrate Writing from POSTS
  const writing = FS_ROOT.children.find(c=>c.name==='Writing');
  if(writing){ writing.children = POSTS.map(p=>({name:`${p.title}.md`, type:'md', slug:p.slug})); }
  renderFinderSidebar();

  const here = CWD ? nodeByPath(CWD) : FS_ROOT;
  if(!CWD) CWD=[];
  byId('crumbs').textContent = ['Macintosh HD', ...CWD].join(' ‚ñ∏ ');

  const grid = byId('grid'); grid.innerHTML='';
  const items = (here.children||[]);
  items.forEach((item, idx)=>{
    const el = document.createElement('div'); el.className='file'; el.tabIndex=0;
    const icon = item.type==='folder'?'üñø': item.type==='md'?'üìÑ': item.type==='img'?'üñºÔ∏è': item.type==='link'?'üîó':'üì¶';
    el.innerHTML = `<div class="ico">${icon}</div><div class="name">${item.name}</div>`;
    let clickTime = 0;
    el.addEventListener('click', ()=>{
      $$('.file', grid).forEach(f=>f.classList.remove('selected')); el.classList.add('selected');
      const now = Date.now(); if(now-clickTime<350){ openItem(item); } clickTime=now;
    });
    el.addEventListener('dblclick', ()=> openItem(item));
    grid.appendChild(el);
  });

  function openItem(item){
    if(item.type==='folder'){ setCWD([...CWD, item.name]); return; }
    if(item.type==='md'){
      if(item.slug){ openPost(item.slug); return; }
      const html = mdToHtml(item.body || '# Empty'); showInViewer(html, item.name); return;
    }
    if(item.type==='img'){
      const html = `<figure><img src="${item.href}" alt="${item.name}" style="max-width:100%"><figcaption>${item.name}</figcaption></figure>`;
      showInViewer(html, item.name); return;
    }
    if(item.type==='link'){ window.open(item.href, '_blank'); return; }
    if(item.href){ window.open(item.href,'_blank'); }
  }
}

/*** Viewer helpers ***/
function showInViewer(html, title='Viewer'){
  byId('viewerBody').innerHTML = html;
  byId('viewer').querySelector('.title').textContent = title;
  openWindow('#viewer');
}
async function openPost(slug){
  const p = POSTS.find(x=>x.slug===slug); if(!p) return;
  const md = await loadPostBody(p); const html = mdToHtml(md);
  showInViewer(html, p.title);
}

/*** Command Palette ***/
const palette = byId('palette'), pinput = byId('pinput'), presults = byId('presults');
function paletteItems(){
  const cmds = [
    {t:'Open: About', run:()=>openWindow('#about')},
    {t:'Open: Now', run:()=>openWindow('#now')},
    {t:'Open: Projects', run:()=>openWindow('#projects')},
    {t:'Open: Finder', run:()=>openWindow('#finder')},
    {t:'Open: Blog', run:()=>openWindow('#blog')},
    {t:'Open: Contact', run:()=>openWindow('#contact')},
  ];
  // add posts
  POSTS.forEach(p=>cmds.push({t:`Post: ${p.title}`, run:()=>openPost(p.slug)}));
  // finder quick nav
  ['Desktop','Documents','Writing','Pictures','Links'].forEach(n=>{
    cmds.push({t:`Finder: ${n}`, run:()=>{openWindow('#finder'); setCWD([n]);}});
  });
  return cmds;
}
let idxSel = 0;
function openPalette(){
  palette.style.display='block'; idxSel=0; renderPalette(''); pinput.value=''; pinput.focus();
}
function closePalette(){ palette.style.display='none'; }
function renderPalette(q){
  const items = paletteItems().filter(c=>c.t.toLowerCase().includes(q.toLowerCase()));
  presults.innerHTML = items.map((c,i)=>`<li class="${i===idxSel?'active':''}" data-i="${i}">${c.t}</li>`).join('');
  $$('#presults li').forEach(li=> li.onclick = ()=>{ idxSel = +li.dataset.i; runSel(); });
  palette.dataset.count = items.length;
}
function runSel(){
  const items = paletteItems().filter(c=>c.t.toLowerCase().includes(pinput.value.toLowerCase()));
  if(!items.length) return; items[idxSel].run(); closePalette();
}
window.addEventListener('keydown', (e)=>{
  if((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); openPalette(); }
  else if(e.key==='Escape' && palette.style.display==='block'){ closePalette(); }
});
pinput.addEventListener('input', ()=>{ idxSel=0; renderPalette(pinput.value); });
pinput.addEventListener('keydown', (e)=>{
  const n = +palette.dataset.count||0;
  if(e.key==='ArrowDown'){ e.preventDefault(); idxSel = (idxSel+1)%Math.max(n,1); renderPalette(pinput.value); }
  if(e.key==='ArrowUp'){ e.preventDefault(); idxSel = (idxSel-1+n)%Math.max(n,1); renderPalette(pinput.value); }
  if(e.key==='Enter'){ e.preventDefault(); runSel(); }
});

/*** Boot ****/
(async function boot(){
  // open About by default
  document.querySelector('#about').style.display='block';
  // blog
  await renderBlog();
  // finder
  buildFS(); setCWD([]); // root
  // keyboard: Enter opens selected desktop icon
  $$('.icon').forEach(icon=> icon.addEventListener('keydown',(e)=>{ if(e.key==='Enter') openWindow(icon.getAttribute('data-open')); }));
})();
</script>
</body>
</html>
